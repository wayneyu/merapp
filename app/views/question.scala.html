@(qn: Question, editable: Boolean)(courses: List[String], terms: List[String], years: List[String], questions: List[String], selectedCourse: String, selectedYear: String, selectedTerm: String, selectedQuestion: String, userRating: Option[Int])(implicit context: service.AppContext[AnyContent])
@q = @{qn.question}
@stmt = @{qn.statement}
@hints = @{qn.hints}
@sols = @{qn.sols}
@answer = @{qn.answer}
@topics = @{qn.topics}
@rating = @{qn.rating}
@num_votes = @{qn.num_votes}
@solvers = @{qn.solvers}
@contributors = @{qn.contributors}
@flags = @{qn.flags}
@latexbuttons = {
<div id="inputbuttons">
    <!-- SYMBOLS -->
    <div class=buttonbox style="width:40%;">
        <a id="button17">${\color{lightgray}x}^{p}$</a>
        <a id="button1">${\color{lightgray}x}_{n}$</a>
        <a id="button3">$\alpha$</a>
        <a id="button12">$\beta$</a>
        <a id="button13">$\gamma$</a>
        <a id="button14">$\delta$</a>
        <a id="button15">$\epsilon$</a>
        <a id="button18">$\lambda$</a>
        <a id="button11">$\pi$</a>
        <a id="button10">$\infty$</a>
        <a id="button21">$\mathbb{R}$</a>
        <a id="button22">$\mathbb{C}$</a>
        <a id="button26">$<$</a>
        <a id="button23">$\leq$</a>
        <a id="button25">$>$</a>
        <a id="button24">$\geq$</a>
        <a id="button29">$\sim$</a>
        <a id="button31">$\dots$</a>
    </div>
    <!-- OPERATORS -->
    <div class=buttonbox style="width:30%;">
        <a id="button20">$\frac{a}{b}$</a>
        <a id="button4">$\frac{d}{dx}$</a>
        <a id="button19">$\frac{d^{2}}{dx^{2}}$</a>
        <a id="button2">$\int_{a}^{b}f(x)\,dx$</a>
        <a id="button9">$\lim_{x \rightarrow a}$</a>
        <a id="button27">$\sin\left({\color{lightgray}\dots} \right)$</a>
        <a id="button28">$\cos\left({\color{lightgray}\dots} \right)$</a>
        <a id="button30">$\sum_{i = 0}^{N}$</a>
    </div>
    <!-- ENVIRONMENTS, ETC. -->
    <div class=buttonbox style="width:20%;">
        <a id="button5"><font color="blue">blue text</font></a>
        <a id="button32"><font color="red">red text</font></a>
        <a id="button6">equation</a>
        <a id="button16">align</a>
        <a id="button33">matrix</a>
        <a id="button34">piecewise</a>
        <a id="button7">$\left({\color{lightgray}\dots} \right)$</a>
        <a id="button8">$\left[{\color{lightgray}\dots} \right]$</a>
    </div>
</div>
<div class="message">
    All math must be written between a pair of '$' characters or in the 'equation' or 'align' environments which can be input by clicking the corresponding buttons below.<br><br>
    Most math symbols are input as you would expect (i.e. the '+' operator is just the '+' button on the keyboard). Other symbols/functions can be input by clicking the buttons directly below. If you can't find the symbol you're looking for, you might be able to find it <a href="https://en.wikibooks.org/wiki/LaTeX/Mathematics">here</a>.
</div>
}


@main("Questions"){
<div id="selection">
@helper.form(action = routes.QuestionController.questionSubmit()) {

    <select id="courseSelect" name="course">
        @for( course <- courses ){
            <option value=@course @if(course == selectedCourse){selected}>@course</option>
        }
        @if(courses.isEmpty && !selectedCourse.isEmpty){
            <option value=@selectedCourse>@selectedCourse</option>
        }
    </select>

    <select id="termSelect" name="term">
        @for( term <- terms ) {
            <option value=@term @if(term == selectedTerm){selected}>@term</option>
        }
        @if(terms.isEmpty && !selectedTerm.isEmpty){
            <option value=@selectedTerm>@selectedTerm</option>
        }
    </select>

    <select id="yearSelect" name="year">
        @for( year <- years ){
            <option value=@year @if(year == selectedYear){selected}>@year</option>
        }
        @if( years.isEmpty && !selectedYear.isEmpty){
            <option value=@selectedYear>@selectedYear</option>
        }
    </select>

    <select id="questionSelect" name="question">
        @for( question <- questions ){
            <option value="@question" @if(question == selectedQuestion){selected}>@question</option>
        }
        @if( questions.isEmpty && !selectedQuestion.isEmpty){
            <option value=@selectedQuestion>@selectedQuestion</option>
        }
    </select>

    <input id="findQuestionBtn" type="submit" value="Jump to Question">
    }
</div>

<br>

<div id="prev_next_question">
    <a id="prev_question">&larr; Previous question</a>
    <a id="next_question">Next question &rarr;</a>
</div>

<br>

<div class="main_box">
    <div class="box_title">
        @q
        <div style="float:right; text-align: right; font-size: 12px; color: #000000; background-color: #FFFFFF;">
            @if(num_votes > 0){
                Easiness: <span class="easiness_rating" title=@num_votes>@rating%</span> <br> (@num_votes @if(num_votes > 1){votes} else {vote})
            } else {-}
        </div>
    </div>
    <div>@Html(stmt)</div>
</div>
@if(editable){
<div class="latex_edit_area" id="statement_html_edit">
    <div class="latex_box">
        @latexbuttons
        <textarea>@Html(stmt)</textarea>
        <div class="latex_edit_render_area"></div>
        <div>
            <button class="render_button">render</button>
            <button class="submit_button">submit changes</button>
        </div>
    </div>
</div>
}

@if(!editable){
    <div class="message">
    Make sure you understand the problem fully: 
    <ul>
    <li>What is the question asking you to do? 
    <li>Are there specific conditions or constraints that you should take note of?</li>
    <li>How will you know if your answer is correct from your work only? </li>
    <li>Can you rephrase the question in your own words in a way that makes sense to you? </li>
    </ul>

    If you are stuck, check the hint below. Consider it for a while. Does it give you a new idea on how to approach the problem? If so, try it! 
    </div>    
}

@for( (h, ind) <- hints.zipWithIndex ) {
    <div class="main_box @if(!editable){hideable_box}">
        <div class="box_title">Hint @if(ind > 0){(@{ind+1})}</div>
        <div>@Html(h)</div>
    </div>
@if(editable){
<div class="latex_edit_area" id=@("hints_html_"+ind+"_edit")>
    <div class="latex_box">
        @latexbuttons
        <textarea>@Html(h)</textarea>
        <div class="latex_edit_render_area"></div>
        <div>
            <button class="render_button">render</button>
            <button class="submit_button">submit changes</button>
        </div>
    </div>
</div>
}
}

@if(!editable){
    <div class="message">Checking a solution serves two purposes:
    <ul>
        <li>Helping you if, after having used the hint, you still are stuck on the problem or... </li> 
        <li>if you have solved the problem and would like to check your work. </li>
    </ul>
    </div>
}

<div class="main_box @if(!editable){hideable_box}">
    <div class="box_title">Final answer</div>
    <div>@Html(answer)</div>
</div>
@if(editable){
<div class="latex_edit_area" id=@("answer_html_edit")>
    <div class="latex_box">
        @latexbuttons
        <textarea>@Html(answer)</textarea>
        <div class="latex_edit_render_area"></div>
        <div>
            <button class="render_button">render</button>
            <button class="submit_button">submit changes</button>
        </div>
    </div>
</div>
}


@for( (s, ind) <- sols.zipWithIndex ) {
    <div class="main_box @if(!editable){hideable_box}">
        <div class="box_title">Full Solution @if(ind > 0){(@{ind+1})}</div>
        <div>@Html(s)</div>
    </div>
@if(editable){
<div class="latex_edit_area" id=@("sols_html_"+ind+"_edit")>
    <div class="latex_box">
        @latexbuttons
        <textarea>@Html(s)</textarea>
        <div class="latex_edit_render_area"></div>
        <div>
            <button class="render_button">render</button>
            <button class="submit_button">submit changes</button>
        </div>
    </div>
</div>
}
}

@if(editable){
    <div>
    Upload image:
    (AT)helper.form(action = routes.QuestionController.upload(request.path), 'enctype -> "multipart/form-data") {
        <input type="file" name="file"><input type="submit">
    }
    </div>
}

<div id="question_topics">
    Topics
    <select class="js-example-tags form-control" multiple="multiple" @if(!editable){disabled="true"}>
        @for( topic <- topics ){ // HELP: Should loop over all topics. selected the topics of this question.
        <option selected="selected">@topic.replace("_"," ")</option>
        }
    </select>
</div>

<div id="question_rating">
    <input id="my_rating" data-show-clear="false" data-symbol="&#x2714;" @if(userRating.isDefined){value=@userRating.get.toString}>
    <!-- see http://plugins.krajee.com/star-rating/demo -->
</div>


@if(solvers){
        This question was solved by <Strong>@solvers.map {solver=>@solver}.mkString(", ")</Strong>
            @if(contributors) {
                with the help of <em>@contributors.map {contr=>@contr}.mkString(", ")</em>.
            } else {.}
        } else {
            @if(contributors) {
                The following people have worked on this question: <em>@contributors.map {contr=>@contr}.mkString(", ")</em>.
            }
        }

}


<script>
$( document ).ready(function() {

$(".question_tags").select2({
  tags: true,
  tokenSeparators: [',', ' ']
    })

$(".js-example-tags").select2({
  tags: true,
  tokenSeparators: [',']
    })

$("#my_rating").rating({
    stars: 10,
    min: 0,
    max: 10,
    step: 1,
    starCaptions: {1: "Impossible", 2: "Very difficult", 3: "Difficult", 4: "A little difficult",
                   5: "A good challenge", 6: "OK", 7: "Relatively simple", 8: "Simple", 9: "Very simple",
                   10: "Aced it"},
    starCaptionClasses: {1: "text-danger", 2: "text-danger",
                         3: "text-warning", 4: "text-warning",
                         5: "text-info", 6: "text-info",
                         7: "text-primary", 8: "text-primary",
                         9: "text-success", 10: "text-success"}
    });
$('#my_rating').on('rating.change', function(event, value, caption) {
    debugger;
    console.log(value);
    console.log(caption);
    $.ajax({
      contentType: 'application/json',
      type: 'GET',
      url: window.location.pathname + "/vote/" + value,
      success: function(d){
        location.reload();
      },
      error: function(obj, st, err){
        alert(err);
      }
    });
});

})
</script>
